Index: src/main/webapp/createStory.jsp
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><%@ page import=\"mx.edu.utez.historiasinteractivas.dao.StoryDao\" %>\n<%@ page import=\"mx.edu.utez.historiasinteractivas.model.Story\" %>\n<%@ page import=\"java.sql.SQLException\" %>\n<%@ page import=\"mx.edu.utez.historiasinteractivas.model.User\" %>\n<%@ page contentType=\"text/html;charset=UTF-8\" language=\"java\" %>\n<%@ taglib prefix=\"c\" uri=\"jakarta.tags.core\" %>\n<!DOCTYPE html>\n<html lang=\"es-MX\">\n<head>\n    <title>Historias Interactivas</title>\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <meta charset=\"UTF-8\">\n    <link rel=\"stylesheet\" href=\"bootstrap/css/bootstrap.min.css\">\n    <link rel=\"stylesheet\" href=\"css/fonts.css\">\n    <link rel=\"stylesheet\" href=\"components/navComponent/nav.css\">\n    <link rel=\"stylesheet\" href=\"css/form.css\">\n    <link rel=\"stylesheet\" href=\"css/waveAnimation.css\">\n    <link rel=\"stylesheet\" href=\"css/themeSwitch.css\">\n    <link rel=\"stylesheet\" href=\"css/createStory.css\">\n</head>\n<%\n    session = request.getSession(false);\n    String idStory = request.getParameter(\"id_story\");\n    if(session.getAttribute(\"user\") == null || idStory == null) {\n        response.sendRedirect(\"index.jsp\");\n        return;\n    }\n    User user = (User) session.getAttribute(\"user\");\n    StoryDao dao = new StoryDao();\n    Story story = null;\n    try {\n        story = dao.findByCode(idStory, user);\n    } catch (SQLException e) {\n        throw new RuntimeException(e);\n    }\n    String storyTitle = story.getStory_title();\n    String diagram = story.getJson();\n%>\n<body class=\"light-mode\" style=\"height: 100vh\">\n<jsp:include page=\"components/navComponent/nav.jsp\" />\n<jsp:include page=\"components/alertComponent/alert.jsp\" />\n\n<section class=\"waves-container1\">\n    <div class=\"wave wave1\" style=\"position: fixed\"></div>\n    <div class=\"wave wave2\" style=\"position: fixed\"></div>\n    <div class=\"wave wave3\" style=\"position: fixed\"></div>\n</section>\n\n<div class=\"container-vertical\">\n    <label class=\"label\" style=\"font-family: 'Noto Sans JP', sans-serif\">\n        <input name=\"storyTitle\" id=\"storyTitle\" type=\"text\" placeholder=\" \" maxlength=\"20\" class=\"input input-group mb-3 fs-6\" required style=\"background-color: var(--mode-background-color); width: 300px\" value=\"<%= storyTitle %>\">\n        <span class=\"labelName fs-6\" style=\"background-color: var(--mode-background-color)\">Titulo de la historia</span>\n    </label>\n    <div id=\"storyDiagram\" class=\"storyDiagram-container\"></div>\n    <div id=\"buttonsBar\" class=\"buttonsBar-container\"></div>\n</div>\n\n<a id=\"PreviewButton\" onclick=\"saveStory('<%=idStory%>')\" href=\"previewStory?id_story=<%=idStory%>\">Preview <i>></i></a>\n<button id=\"SaveButton\" onclick=\"saveStory('<%=idStory%>')\">Guardar historia</button>\n<br>\n<!-- Estp esta oculto pero contiene el diagrama que se carga al abrir la historia\n     Aqui deberiamos cargar el json de lahistoria cargado -->\n<textarea id=\"mySavedModel\" style=\"width: 100%; height: 300px; background-color: transparent; display: none\">\n    <%= diagram %>\n</textarea>\n\n<!-- Modal de Edici√≥n -->\n<div id=\"editModal\">\n    <div id=\"modalContent\">\n        <span class=\"close\" onclick=\"closeModal()\">&times;</span>\n        <h2 class=\"mb-2\">Editar Evento</h2>\n        <form id=\"editForm\" enctype=\"multipart/form-data\">\n            <div id=\"dropArea\" class=\"mb-4\">\n                <p>Arrastra y suelta archivos aqu√≠ o haz clic para seleccionar archivos</p>\n                <input type=\"file\" id=\"fileUpload\" name=\"fileUpload\" style=\"display: none; \" accept=\"image/*,audio/*,video/*\" multiple/>\n            </div>\n            <!-- Contenedor de las vistas previas -->\n            <div id=\"imagePreviewContainer\" class=\"preview-container\">\uD83D\uDCF7 Imagen</div>\n            <div id=\"audioPreviewContainer\" class=\"preview-container\">\uD83D\uDD09 Audio</div>\n            <div id=\"videoPreviewContainer\" class=\"preview-container mb-4\">\uD83D\uDCFD\uFE0F Video</div>\n\n            <label class=\"label\">\n                <input name=\"nodeText\" id=\"nodeText\" type=\"text\" placeholder=\" \" class=\"input input-group mb-3 fs-6\" required>\n                <span class=\"labelName fs-6\">Nombre del evento</span>\n            </label>\n            <label class=\"label\">\n                <textarea name=\"nodeDescription\" id=\"nodeDescription\" type=\"text\" placeholder=\" \" class=\"input input-group mb-3 fs-6\" style=\"height: 60px\"></textarea>\n                <span class=\"labelName fs-6\">Descripci√≥n</span>\n            </label>\n            <button class=\"button\" type=\"button\" onclick=\"saveNodeData()\">Aceptar</button>\n        </form>\n    </div>\n</div>\n\n<script src=\"js/createStory.js\"></script>\n<script src=\"components/navComponent/themeSwitch.js\"></script>\n<script src=\"bootstrap/js/bootstrap.min.js\"></script>\n<script src=\"js/go.js\"></script>\n<script src=\"js/autoScroller.js\"></script>\n</body>\n</html>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/webapp/createStory.jsp b/src/main/webapp/createStory.jsp
--- a/src/main/webapp/createStory.jsp	(revision 0ceb3f902a03aad118cab1bf3dd6252a91025d1b)
+++ b/src/main/webapp/createStory.jsp	(date 1723844862334)
@@ -68,7 +68,7 @@
 <div id="editModal">
     <div id="modalContent">
         <span class="close" onclick="closeModal()">&times;</span>
-        <h2 class="mb-2">Editar Evento</h2>
+        <h2 class="mb-2">Editar Escena</h2>
         <form id="editForm" enctype="multipart/form-data">
             <div id="dropArea" class="mb-4">
                 <p>Arrastra y suelta archivos aqu√≠ o haz clic para seleccionar archivos</p>
@@ -79,13 +79,13 @@
             <div id="audioPreviewContainer" class="preview-container">üîâ Audio</div>
             <div id="videoPreviewContainer" class="preview-container mb-4">üìΩÔ∏è Video</div>
 
-            <label class="label">
+            <label class="label" id="decision">
                 <input name="nodeText" id="nodeText" type="text" placeholder=" " class="input input-group mb-3 fs-6" required>
-                <span class="labelName fs-6">Nombre del evento</span>
+                <span class="labelName fs-6">Decisi√≥n:</span>
             </label>
             <label class="label">
-                <textarea name="nodeDescription" id="nodeDescription" type="text" placeholder=" " class="input input-group mb-3 fs-6" style="height: 60px"></textarea>
-                <span class="labelName fs-6">Descripci√≥n</span>
+                <textarea name="nodeDescription" id="nodeDescription" type="text" placeholder=" " class="input input-group mb-3 fs-6" style="height: 60px" required></textarea>
+                <span class="labelName fs-6">Descripci√≥n:</span>
             </label>
             <button class="button" type="button" onclick="saveNodeData()">Aceptar</button>
         </form>
Index: src/main/webapp/js/createStory.js
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>function init() {\n\tconst $ = go.GraphObject.make;\n\t\n\t// Paleta de colores a utilizar para los elementos\n\tvar purple = '#5114d3';\n\tvar blue = '#00A6ED';\n\tvar red = '#ff0000';\n\tvar white = '#FFF'\n\t\n\tvar selectColor = '#00A6ED';\n\tvar lineColor = '#9a73ee';\n\t\n\t// Estilizaci√≥n del texto en los eventos\n\tfunction textStyle() {\n\t\treturn {\n\t\t\tmargin: 10,\n\t\t\twrap: go.Wrap.Fit,\n\t\t\ttextAlign: 'center',\n\t\t\teditable: false,\n\t\t\tstroke: white,\n\t\t};\n\t}\n\t\n\tstoryDiagram = new go.Diagram ('storyDiagram', {\n\t\t'toolManager.mouseWheelBehavior': go.WheelMode.Zoom,\n\t\tinitialAutoScale: go.AutoScale.Uniform,\n\t\t'linkingTool.direction': go.LinkingDirection.ForwardsOnly,\n\t\tlayout: $ (go.LayeredDigraphLayout, {\n\t\t\tisInitial: false,\n\t\t\tisOngoing: false,\n\t\t\tlayerSpacing: 100,\n\t\t}),\n\t\t'undoManager.isEnabled': true,\n\t});\n\t\n\t// Escuchar el evento de doble clic en el nodo\n\tstoryDiagram.nodeTemplate =\n\t\t$ (go.Node, 'Auto',\n\t\t\t{\n\t\t\t\tdoubleClick: openEditModal // Abrir modal al hacer doble clic\n\t\t\t},\n\t\t\tnew go.Binding ('location', 'loc', go.Point.parse).makeTwoWay (go.Point.stringify),\n\t\t\t$ (go.Shape, 'RoundedRectangle',\n\t\t\t\t{\n\t\t\t\t\tfill: 'white',\n\t\t\t\t\tstroke: 'rgba(0,0,0,0)',\n\t\t\t\t\tportId: '',\n\t\t\t\t\tfromLinkable: true,\n\t\t\t\t\ttoLinkable: true,\n\t\t\t\t\tcursor: 'pointer',\n\t\t\t\t\ttoEndSegmentLength: 50,\n\t\t\t\t\tfromEndSegmentLength: 40\n\t\t\t\t},\n\t\t\t\tnew go.Binding ('fill', 'color')\n\t\t\t),\n\t\t\t$ (go.TextBlock, 'Evento', textStyle (),\n\t\t\t\tnew go.Binding ('text', 'text').makeTwoWay ())\n\t\t);\n\t\n\tstoryDiagram.commandHandler.deleteSelection = function () {\n\t\tvar diagram = this.diagram;\n\t\tvar selectedParts = diagram.selection;\n\t\tvar nodesToDelete = [];\n\t\tselectedParts.each (function (part) {\n\t\t\tif (part instanceof go.Node && part.data.category === 'startEvent') {\n\t\t\t\talert ('El nodo de inicio no se puede eliminar.');\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tnodesToDelete.push (part);\n\t\t});\n\t\t\n\t\t// Solo eliminar si hay nodos a posibles\n\t\tif (nodesToDelete.length > 0) {\n\t\t\tdiagram.startTransaction ('Delete Selection');\n\t\t\tnodesToDelete.forEach (function (part) {\n\t\t\t\tdiagram.remove (part);\n\t\t\t});\n\t\t\tdiagram.commitTransaction ('Delete Selection');\n\t\t}\n\t};\n\t\n\t// Actualiza estilos para representar que hay cambios sin guardar\n\t// !NOTA! \"e\" no usado eliminar mas adelante si no lo necesitamo\n\tstoryDiagram.addDiagramListener ('Modified', (e) => {\n\t\tvar button = document.getElementById ('SaveButton');\n\t\tif (button) button.disabled = !storyDiagram.isModified;\n\t\tvar idx = document.title.indexOf ('*');\n\t\tif (storyDiagram.isModified) {\n\t\t\tif (idx < 0) document.title += '*';\n\t\t\tbutton.style.backgroundColor = '#5100ff';\n\t\t} else {\n\t\t\tif (idx >= 0) document.title = document.title.slice (0, idx);\n\t\t\tbutton.style.backgroundColor = '#945fff';\n\t\t}\n\t});\n\t\n\tvar defaultAdornment =\n\t\t$ (go.Adornment, 'Spot',\n\t\t\t$ (go.Panel, 'Auto',\n\t\t\t\t$ (go.Shape, {fill: null, stroke: selectColor, strokeWidth: 3}),\n\t\t\t\t$ (go.Placeholder)\n\t\t\t),\n\t\t\t$ ('Button', {\n\t\t\t\t\talignment: new go.Spot (1, 0, -5, 5),\n\t\t\t\t\tclick: addNodeAndLink,\n\t\t\t\t},\n\t\t\t\tnew go.Binding ('visible', '', (a) => !a.diagram.isReadOnly).ofObject (),\n\t\t\t\t$ (go.Shape, 'PlusLine',\n\t\t\t\t\t{desiredSize: new go.Size (6, 6), stroke: '#9568f8'} // Cambiar color del √≠cono a blanco\n\t\t\t\t)\n\t\t\t)\n\t\t);\n\t\n\tstoryDiagram.nodeTemplateMap.add (\n\t\t'middleEvent',\n\t\t$ (go.Node, 'Auto',\n\t\t\t{\n\t\t\t\tselectionAdornmentTemplate: defaultAdornment,\n\t\t\t\tisShadowed: false,\n\t\t\t\tdoubleClick: openEditModal // Abrir modal al hacer doble clic\n\t\t\t},\n\t\t\tnew go.Binding ('location', 'loc', go.Point.parse).makeTwoWay (go.Point.stringify),\n\t\t\t$ (go.Shape,\n\t\t\t\t'RoundedRectangle',\n\t\t\t\t{\n\t\t\t\t\tfill: purple,\n\t\t\t\t\tstroke: lineColor,\n\t\t\t\t\tportId: '',\n\t\t\t\t\tfromLinkable: true,\n\t\t\t\t\ttoLinkable: true,\n\t\t\t\t\tcursor: 'pointer',\n\t\t\t\t\ttoEndSegmentLength: 50,\n\t\t\t\t\tfromEndSegmentLength: 40,\n\t\t\t\t},\n\t\t\t\tnew go.Binding ('fill', 'color')\n\t\t\t),\n\t\t\t$ (go.TextBlock, 'Evento', textStyle (), new go.Binding ('text', 'text').makeTwoWay ())\n\t\t)\n\t);\n\t\n\tstoryDiagram.nodeTemplateMap.add (\n\t\t'startEvent',\n\t\t$ (go.Node, 'Auto',\n\t\t\t{\n\t\t\t\tisShadowed: false,\n\t\t\t\tdoubleClick: openEditModal // Abrir modal al hacer doble clic\n\t\t\t},\n\t\t\tnew go.Binding ('location', 'loc', go.Point.parse).makeTwoWay (go.Point.stringify),\n\t\t\t$ (go.Shape,\n\t\t\t\t'RoundedRectangle',\n\t\t\t\t{\n\t\t\t\t\tname: 'SHAPE',\n\t\t\t\t\tfill: blue,\n\t\t\t\t\tstroke: lineColor,\n\t\t\t\t\tportId: '',\n\t\t\t\t\tfromLinkable: true,\n\t\t\t\t\ttoLinkable: false,\n\t\t\t\t\tcursor: 'pointer',\n\t\t\t\t\ttoEndSegmentLength: 50,\n\t\t\t\t\tfromEndSegmentLength: 40,\n\t\t\t\t},\n\t\t\t\tnew go.Binding ('fill', 'color')\n\t\t\t),\n\t\t\t$ (go.TextBlock, 'Inicio', textStyle (), new go.Binding ('text', 'text').makeTwoWay ())\n\t\t)\n\t);\n\t\n\tstoryDiagram.nodeTemplateMap.add (\n\t\t'endEvent',\n\t\t$ (go.Node, 'Auto',\n\t\t\t{\n\t\t\t\tisShadowed: false,\n\t\t\t\tdoubleClick: openEditModal // Abrir modal al hacer doble clic\n\t\t\t},\n\t\t\tnew go.Binding ('location', 'loc', go.Point.parse).makeTwoWay (go.Point.stringify),\n\t\t\t$ (go.Shape, 'RoundedRectangle', {\n\t\t\t\tfill: red,\n\t\t\t\tstroke: lineColor,\n\t\t\t\tportId: '',\n\t\t\t\ttoLinkable: true,\n\t\t\t\ttoEndSegmentLength: 50\n\t\t\t}, new go.Binding ('fill', 'color')),\n\t\t\t$ (go.TextBlock, 'Final', textStyle (), new go.Binding ('text', 'text').makeTwoWay ())\n\t\t)\n\t);\n\t\n\t// click en el bot√≥n de un nodo middleEvent inserta un nuevo nodo a la derecha del nodo seleccionado\n\t// y agrega un enlace a ese nuevo nodo\n\tfunction addNodeAndLink(e, obj) {\n\t\tvar adorn = obj.part;\n\t\tif (adorn === null) return;\n\t\te.handled = true;\n\t\tvar diagram = adorn.diagram;\n\t\tdiagram.startTransaction ('Add State');\n\t\tvar fromNode = adorn.adornedPart;\n\t\tvar fromData = fromNode.data;\n\t\t\n\t\t// Verificar la cantidad de conexiones salientes del nodo para evitar +3 conexiones\n\t\tvar outgoingLinks = fromNode.findLinksOutOf ().count;\n\t\tif (outgoingLinks >= 2) {\n\t\t\talert ('El evento no puede tener m√°s de dos conexiones salientes.');\n\t\t\tdiagram.commitTransaction ('Add State');\n\t\t\treturn;\n\t\t}\n\t\t\n\t\t// Crear un nuevo objeto de datos \"State\", posicionado a la derecha del nodo middleEvent\n\t\tvar toData = {category: 'middleEvent'};\n\t\tvar p = fromNode.location;\n\t\ttoData.loc = p.x + 200 + ' ' + p.y; // la propiedad \"loc\" es un string, no un objeto Point\n\t\t// Agregar los nuevos datos del nodo al modelo\n\t\tvar model = diagram.model;\n\t\tmodel.addNodeData (toData);\n\t\t// Crear un enlace de datos desde los datos del nodo antiguo a los datos del nuevo nodo\n\t\tvar linkdata = {};\n\t\tlinkdata[model.linkFromKeyProperty] = model.getKeyForNodeData (fromData);\n\t\tlinkdata[model.linkToKeyProperty] = model.getKeyForNodeData (toData);\n\t\t// Agregar los datos del enlace al modelo\n\t\tmodel.addLinkData (linkdata);\n\t\t// Al crearlo dejar el selector pocisionado en el nuevo nodo\n\t\tvar newnode = diagram.findNodeForData (toData);\n\t\tdiagram.select (newnode);\n\t\tdiagram.commitTransaction ('Add State');\n\t}\n\t// Template de el trazado de los nodos y sus conexiones\n\tstoryDiagram.linkTemplate = $ (go.Link,\n\t\t{curve: go.Curve.Bezier, toShortLength: 5, fromSpot: go.Spot.Right, toSpot: go.Spot.Left},\n\t\t$ (go.Shape,\n\t\t\t{stroke: lineColor, strokeWidth: 2.5}\n\t\t),\n\t\t$ (go.Shape,\n\t\t\t{toArrow: 'Kite', fill: lineColor, stroke: lineColor, scale: 1.5}\n\t\t)\n\t);\n\t\n\t// Cuando se crea un nuevo enlace, determinar qu√© plantilla usar\n\tstoryDiagram.addDiagramListener ('LinkDrawn', (e) => {\n\t\tvar link = e.subject;\n\t\tif (link.fromNode.findLinksOutOf ().count > 2) {\n\t\t\tstoryDiagram.remove (link);\n\t\t\talert ('El evento no puede tener m√°s de dos conexiones salientes.');\n\t\t} else if (link.toNode.findLinksInto ().count > 2) {\n\t\t\tstoryDiagram.remove (link);\n\t\t\talert ('El evento no puede tener m√°s de dos conexiones entrantes.');\n\t\t}\n\t});\n\t\n\tvar buttonsBar = new go.Palette (\n\t\t'buttonsBar', // Crear una nueva Paleta en el elemento HTML DIV\n\t\t{\n\t\t\t// Compartir el mapa de plantillas con la Paleta\n\t\t\tnodeTemplateMap: storyDiagram.nodeTemplateMap,\n\t\t\tautoScale: go.AutoScale.Uniform, // Responsividad del GoJS\n\t\t}\n\t);\n\t\n\tbuttonsBar.model.nodeDataArray = [\n\t\t{category: 'middleEvent'},\n\t\t{category: 'endEvent'},\n\t];\n\t\n\t\n\t// Leer los datos en formato JSON del elemento \"mySavedModel\" cargados apartir del JAVA\n\tload ();\n\tlayout ();\n}\n\n// Funci√≥n para abrir el modal\nfunction openEditModal(e, obj) {\n\tvar node = obj.part;\n\tif ( !node) return;\n\t\n\tvar data = node.data;\n\t\n\t// Cargar los datos del nodo en el formulario\n\tdocument.getElementById ('nodeText').value = data.text || '';\n\tdocument.getElementById ('nodeDescription').value = data.description || '';\n\tdocument.getElementById ('fileUpload').value = ''; // Limpiar archivo cargado\n\t\n\t// Limpiar las vistas previas\n\tclearPreviews ();\n\t\n\t// Actualizar vistas previas si ya hay archivos cargados\n\tif (data.image) {\n\t\tdocument.getElementById ('imagePreviewContainer').classList.add ('active');\n\t}\n\tif (data.audio) {\n\t\tdocument.getElementById ('audioPreviewContainer').classList.add ('active');\n\t}\n\tif (data.video) {\n\t\tdocument.getElementById ('videoPreviewContainer').classList.add ('active');\n\t}\n\t\n\t// Mostrar el √°rea de arrastre si no hay combinaci√≥n de imagen y audio\n\tif ( !(data.image && data.audio) && !data.video) {\n\t\tdocument.getElementById ('dropArea').style.display = 'block';\n\t} else {\n\t\tdocument.getElementById ('dropArea').style.display = 'none';\n\t}\n\t\n\t// Mostrar el modal\n\tdocument.getElementById ('editModal').style.display = 'flex';\n\t\n\t// Guardar los datos del nodo en el modal\n\twindow.currentNode = node; // Guardar referencia al nodo actual\n}\n\n// Funci√≥n para cerrar el modal\nfunction closeModal() {\n\tdocument.getElementById ('editModal').style.display = 'none';\n}\n\n// Funci√≥n para guardar los datos del nodo\nfunction saveNodeData() {\n\tvar node = window.currentNode;\n\tif (!node) return;\n\n\tvar formData = new FormData(document.getElementById('editForm'));\n\tvar fileInput = document.getElementById('fileUpload');\n\n\tif (fileInput.files.length > 0) {\n\t\tfetch('uploadFiles', {\n\t\t\tmethod: 'POST',\n\t\t\tbody: formData\n\t\t})\n\t\t\t.then(response => response.text())  // Obtener la ruta del archivo\n\t\t\t.then(filePaths => {\n\t\t\t\tconsole.log(\"Respuestas del servidor:\", filePaths);\n\t\t\t\tvar text = document.getElementById('nodeText').value;\n\t\t\t\tvar description = document.getElementById('nodeDescription').value;\n\n\t\t\t\tstoryDiagram.model.setDataProperty(node.data, 'text', text);\n\t\t\t\tstoryDiagram.model.setDataProperty(node.data, 'description', description);\n\n\t\t\t\t// Dividir las rutas en base al salto de l√≠nea\n\t\t\t\tvar paths = filePaths.trim().split('\\n');\n\n\t\t\t\t// Establecer la propiedad correspondiente seg√∫n el tipo de archivo\n\t\t\t\tpaths.forEach(path => {\n\t\t\t\t\tif (path.includes('storiesImages')) {\n\t\t\t\t\t\tstoryDiagram.model.setDataProperty(node.data, 'image', path);\n\t\t\t\t\t} else if (path.includes('storiesAudio')) {\n\t\t\t\t\t\tstoryDiagram.model.setDataProperty(node.data, 'audio', path);\n\t\t\t\t\t} else if (path.includes('storiesVideo')) {\n\t\t\t\t\t\tstoryDiagram.model.setDataProperty(node.data, 'video', path);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tcloseModal();\n\t\t\t})\n\t\t\t.catch(error => {\n\t\t\t\tconsole.error('Error al subir el archivo:', error);\n\t\t\t});\n\t} else {\n\t\tconsole.log(\"me ejecuto hasta aqui V2\")\n\t\t// Si no hay archivo, solo actualiza los dem√°s datos\n\t\tvar text = document.getElementById('nodeText').value;\n\t\tvar description = document.getElementById('nodeDescription').value;\n\n\t\tstoryDiagram.model.setDataProperty(node.data, 'text', text);\n\t\tstoryDiagram.model.setDataProperty(node.data, 'description', description);\n\t\tcloseModal();\n\t}\n}\n\n// Configuraci√≥n de arrastrar y soltar\ndocument.getElementById ('dropArea').addEventListener ('dragover', function (event) {\n\tevent.preventDefault ();\n\tevent.stopPropagation ();\n\tevent.dataTransfer.dropEffect = 'copy';\n\tthis.classList.add ('dragover');\n});\n\ndocument.getElementById ('dropArea').addEventListener ('dragleave', function (event) {\n\tevent.preventDefault ();\n\tevent.stopPropagation ();\n\tthis.classList.remove ('dragover');\n});\n\ndocument.getElementById ('dropArea').addEventListener ('drop', function (event) {\n\tevent.preventDefault ();\n\tevent.stopPropagation ();\n\tthis.classList.remove ('dragover');\n\t\n\tvar files = event.dataTransfer.files;\n\thandleFiles (files);\n});\n\ndocument.getElementById ('dropArea').addEventListener ('click', function () {\n\tdocument.getElementById ('fileUpload').click ();\n});\n\ndocument.getElementById ('fileUpload').addEventListener ('change', function (event) {\n\tvar files = event.target.files;\n\thandleFiles (files);\n});\n\n// Funci√≥n para manejar los archivos\nfunction handleFiles(files) {\n\tlet image = document.getElementById ('imagePreviewContainer').classList.contains ('active');\n\tlet audio = document.getElementById ('audioPreviewContainer').classList.contains ('active');\n\tlet video = document.getElementById ('videoPreviewContainer').classList.contains ('active');\n\t\n\tfor (let file of files) {\n\t\tif (file.type.startsWith ('image/')) {\n\t\t\tif (video) {\n\t\t\t\talert ('No se permite subir imagen junto con video.');\n\t\t\t\treturn;\n\t\t\t}\n\t\t\timage = true;\n\t\t\tdocument.getElementById ('imagePreviewContainer').classList.add ('active');\n\t\t} else if (file.type.startsWith ('audio/')) {\n\t\t\tif (video) {\n\t\t\t\talert ('No se permite subir audio junto con video.');\n\t\t\t\treturn;\n\t\t\t}\n\t\t\taudio = true;\n\t\t\tdocument.getElementById ('audioPreviewContainer').classList.add ('active');\n\t\t} else if (file.type.startsWith ('video/')) {\n\t\t\tif (image || audio) {\n\t\t\t\talert ('No se permite subir video junto con imagen o audio.');\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvideo = true;\n\t\t\tdocument.getElementById ('videoPreviewContainer').classList.add ('active');\n\t\t}\n\t}\n\t\n\t// Mostrar u ocultar el √°rea de arrastre seg√∫n las combinaciones permitidas\n\tif (image && audio) {\n\t\tdocument.getElementById ('dropArea').style.display = 'none';\n\t} else {\n\t\tdocument.getElementById ('dropArea').style.display = 'block';\n\t}\n}\n\n// Funci√≥n para limpiar las vistas previas\nfunction clearPreviews() {\n\tdocument.getElementById ('imagePreviewContainer').classList.remove ('active');\n\tdocument.getElementById ('audioPreviewContainer').classList.remove ('active');\n\tdocument.getElementById ('videoPreviewContainer').classList.remove ('active');\n}\n\n// Funci√≥n de guardar el diagrama en formato JSON\nfunction saveStory(idStory) {\n\tdocument.getElementById ('mySavedModel').value = storyDiagram.model.toJson ();\n\tstoryDiagram.isModified = false;\n\n\tconst storyTitle = document.getElementById(\"storyTitle\").value;\n\tconst storyData = storyDiagram.model.toJson();\n\n\t// Crear el objeto de datos que se enviar√° al servlet\n\tconst dataToSend = {\n\t\ttitle: storyTitle,\n\t\tdiagram: storyData,\n\t\tidStory: idStory\n\t};\n\n\t// Hacer la solicitud AJAX al servlet\n\tfetch('storyDiagram', {\n\t\tmethod: 'POST',\n\t\theaders: {\n\t\t\t'Content-Type': 'application/json'\n\t\t},\n\t\tbody: JSON.stringify(dataToSend)\n\t})\n\t\t.then(response => response.json())  // Esperar una respuesta JSON del servlet\n\t\t.then(data => {\n\t\t\t// Procesar la respuesta del servlet\n\t\t\tconsole.log(\"Respuesta del servidor:\", data);\n\t\t})\n\t\t.catch(error => {\n\t\t\tconsole.error(\"Error al guardar la historia:\", error);\n\t\t});\n\n\tconsole.log (storyDiagram.model.toJson ());\n}\n\n// Funci√≥n para cargar el modelo guardado en JSON\nfunction load() {\n\tstoryDiagram.model = go.Model.fromJson (document.getElementById ('mySavedModel').value);\n}\n\nfunction layout() {\n\tstoryDiagram.layoutDiagram (true);\n}\n\nconst storyTitleLabel = document.getElementById(\"storyTitle\")\nstoryTitleLabel.addEventListener(\"keydown\", function (e) {\n\tif (this.value.length >= 20 && e.key !== \"Backspace\") {\n\t\te.preventDefault();\n\t}\n})\n\n\nwindow.addEventListener ('DOMContentLoaded', init);
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/webapp/js/createStory.js b/src/main/webapp/js/createStory.js
--- a/src/main/webapp/js/createStory.js	(revision 0ceb3f902a03aad118cab1bf3dd6252a91025d1b)
+++ b/src/main/webapp/js/createStory.js	(date 1723845207883)
@@ -53,7 +53,7 @@
 				},
 				new go.Binding ('fill', 'color')
 			),
-			$ (go.TextBlock, 'Evento', textStyle (),
+			$ (go.TextBlock, 'Escena', textStyle (),
 				new go.Binding ('text', 'text').makeTwoWay ())
 		);
 	
@@ -134,7 +134,7 @@
 				},
 				new go.Binding ('fill', 'color')
 			),
-			$ (go.TextBlock, 'Evento', textStyle (), new go.Binding ('text', 'text').makeTwoWay ())
+			$ (go.TextBlock, 'Escena', textStyle (), new go.Binding ('text', 'text').makeTwoWay ())
 		)
 	);
 	
@@ -289,7 +289,21 @@
 	if (data.video) {
 		document.getElementById ('videoPreviewContainer').classList.add ('active');
 	}
-	
+
+	var decisionInput = document.getElementById('nodeText');
+	var labelDecision = document.getElementById('decision');
+	if (data.category === 'startEvent') {
+		decisionInput.value = 'Inicio'; // Rellenar autom√°ticamente con "Inicio"
+		decisionInput.readOnly = true; // Deshabilitar edici√≥n
+		decisionInput.style.display = 'none'; // Ocultar los input
+		labelDecision.style.display = 'none';
+	} else {
+		decisionInput.value = data.description || '';
+		decisionInput.readOnly = false; // Habilitar edici√≥n
+		decisionInput.style.display = 'block'; // Mostrar los input
+		labelDecision.style.display = 'grid';
+	}
+
 	// Mostrar el √°rea de arrastre si no hay combinaci√≥n de imagen y audio
 	if ( !(data.image && data.audio) && !data.video) {
 		document.getElementById ('dropArea').style.display = 'block';
